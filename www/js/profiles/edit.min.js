function profile_edit_validate(){var e=!0;$(document).find("#input_name").val().length<=1&&(e=!1),$(document).find("#input_last_name").val().length<=1&&(e=!1),$(document).find("#input_name").val()==user.first_name&&$(document).find("#input_last_name").val()==user.last_name&&(e=!1),$(document).find("#profile_img input").attr("val")&&$(document).find("#profile_img input").attr("val")!=user.image&&(e=!0),e?$(document).find("#profile_info_save").addClass("_active_"):$(document).find("#profile_info_save").removeClass("_active_")}function profile_edit_init(){if($(document).find("#input_name").val(user.first_name),$(document).find("#input_name").attr("placeholder",user.first_name),$(document).find("#input_last_name").val(user.last_name),$(document).find("#input_last_name").attr("placeholder",user.last_name),$(document).find("#input_email").val(user.email),user.image){var e='<img src="'+site_url+user.image.substring(1).replace("/image/","/image_min/")+'">';$(document).find("#profile_img label").removeClass("__default"),$(document).find("#profile_img label").append(e),$(document).find("#profile_img input").attr("val",user.image)}profile_edit_validate()}$(function(){$(document).on("click","#profile_img label",function(){$(document).find("#profile_img input").click()}),$(document).on("change","#profile_img input",function(){if($(this).val()!=user.image){var e=$(this).prop("files")[0],i=["Будим программистов","Нагружаем сервер","Освобождаем место","Ускоряем интернет"],a=new FormData,n=$(this).parents("#profile_img");n.addClass("_loading_");var t={};t.alert=i[Math.floor(Math.random()*i.length)],app_status(t),a.append("file_image",e),a.append("app","app"),a.append("session_key",session_key),$.ajax({url:site_url,data:a,dataType:"text",cache:!1,contentType:!1,processData:!1,method:"POST"}).fail(function(e){n.removeClass("_loading_");var i={};return i.error="Ошибка соединения",app_status(i),!1}).done(function(e){if($(document).find("#profile_img").removeClass("_loading_"),e.indexOf("uploads")+1){$(document).find("#profile_img label").hasClass("__default")&&($(document).find("#profile_img label").removeClass("__default"),$(document).find("#profile_img label").append("<img></img>")),$(document).find("#profile_img").find("input").attr("val",e),$(document).find("#profile_img").find("img").attr("src",site_url+e.substring(1).replace("/image/","/image_min/"));(i={}).success="Изображение успешно загруженно",app_status(i),i.success="Не забудьте сохранить изменения",app_status(i),profile_edit_validate()}else{var i=$.parseJSON(e);app_status(i)}})}return!1}),$(document).on("input",".profile_info input",function(){profile_edit_validate()}),$(document).on("click","#profile_info_save",function(){if($(this).hasClass("_active_")){user.first_name=$(document).find("#input_name").val(),user.last_name=$(document).find("#input_last_name").val(),user.image=$(document).find("#profile_img input").attr("val");$.ajax({url:site_url,data:$.extend(user,ajax_salt,{form:"form_user_edit"}),method:"POST"}).fail(function(e){return app_status({error:"Ошибка соединения"}),!1}).done(function(e){if(e){var i=$.parseJSON(e);app_status(i),i.error||(localStorage.setItem("user",JSON.stringify(user)),$(document).find("#profile_info_save").removeClass("_active_")),$("#main_menu_show").removeClass("_no_active_")}})}return!1})});