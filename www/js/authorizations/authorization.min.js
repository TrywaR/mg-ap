function authorization(){if(session_key){if($.when(content_download({form:"session_validation"})).done(function(t){var o=$.parseJSON(t);o.error?(app_status(o),localStorage.clear(),session_key="",user={},authorization()):(user=o,localStorage.setItem("user",JSON.stringify(user)))}),active_buttons(),$(document).find("#profile_page a").data("id",user.id),arrPagesHistory.length>0){var t=arrPagesHistory[arrPagesHistory.length-1];arrPagesHistory=arrPagesHistory.slice(0,arrPagesHistory.length-2),content_upload(t.url,t)}else user.first_name?content_upload("profile.htm?pages_history_not=true",{users:"users",id:user.id}):(content_upload("profiles/edit.htm?pages_history_not=true"),$("#main_menu_show").addClass("_no_active_"));return!1}active_buttons(),content_upload("authorizations/authorization.htm?pages_history_not=true")}function authorization_message(t){$(document).find(".authorization_form .form_status").removeClass("_error"),$(document).find(".authorization_form .form_status").html(""),t.error&&$(document).find(".authorization_form .form_status").addClass("_error").html(t.error),t.alert&&$(document).find(".authorization_form .form_status").html(t.alert),t.success&&$(document).find(".authorization_form .form_status").html(t.success)}$(function(){authorization(),$(document).on("input",'#authorization_form input[name="email"]',function(){var t=$(this).val().replace(/\s/g,"");$(this).val(t.toLowerCase())}),$(document).on("submit","#authorization_form",function(){return $.ajax({url:site_url,data:$(this).serializeArray(),method:"POST"}).fail(function(t){var o={};return o.error="Ошибка соединения",authorization_message(o),!1}).done(function(t){var o=$.parseJSON(t);authorization_message(o),o.error||(user=o,session_key=user.session_key,ajax_salt.session_key=session_key,localStorage.setItem("session_key",session_key),localStorage.setItem("user",JSON.stringify(user)),authorization())}),!1}),$(document).on("submit","#password_form",function(){return!1}),$(document).on("submit","#password-code_form",function(){return!1}),$(document).on("submit","#password-new_form",function(){return!1}),$(document).on("click","#profile_exit",function(){localStorage.clear(),session_key="",user={},authorization()})});