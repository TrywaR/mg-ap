function authorization(){if(session_key){var t=$.extend(user,ajax_salt,{form:"session_validation"});return $.ajax({url:site_url,data:t,method:"POST"}).fail(function(t){var o={};return o.error="Ошибка соединения",app_status(o),!1}).done(function(t){var o=$.parseJSON(t);o.error?(app_status(o),localStorage.clear(),session_key="",user={},authorization()):(user=o,localStorage.setItem("user",JSON.stringify(user)))}),active_buttons(),$(document).find("#profile_page a").data("id",user.id),user.first_name?content_upload("profile.htm",{form:"session_validation"}):content_upload("profiles/edit.htm"),!1}active_buttons(),content_upload("templates/authorizations/authorization.htm")}function authorization_message(t){$(document).find(".authorization_form .form_status").removeClass("_error"),$(document).find(".authorization_form .form_status").html(""),t.error&&$(document).find(".authorization_form .form_status").addClass("_error").html(t.error),t.alert&&$(document).find(".authorization_form .form_status").html(t.alert),t.success&&$(document).find(".authorization_form .form_status").html(t.success)}$(function(){authorization(),$(document).on("input",'#authorization_form input[name="login"]',function(){var t=$(this).val().replace(/\s/g,"");$(this).val(t.toLowerCase())}),$(document).on("submit","#authorization_form",function(){return $.ajax({url:site_url,data:$(this).serializeArray(),method:"POST"}).fail(function(t){var o={};return o.error="Ошибка соединения",authorization_message(o),!1}).done(function(t){var o=$.parseJSON(t);authorization_message(o),o.error||(user=o,session_key=user.session_key,ajax_salt.session_key=session_key,localStorage.setItem("session_key",session_key),localStorage.setItem("user",JSON.stringify(user)),authorization())}),!1}),$(document).on("submit","#password_form",function(){return!1}),$(document).on("submit","#password-code_form",function(){return!1}),$(document).on("submit","#password-new_form",function(){return!1}),$(document).on("click","#profile_exit",function(){localStorage.clear(),session_key="",user={},authorization()})});