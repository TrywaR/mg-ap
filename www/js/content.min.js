function menu_add(a){var t='<li class="page_'+a.class+'"><a class="content_upload" href="'+a.href+'">'+a.title+"</a></li>";$(document).find("#main_menu nav ul #profile_exit").before(t)}function content_template(a){return sTemplatePath="templates/"+a,$.post(sTemplatePath).fail(function(a){app_status({error:"Шаблон не найден"})}).done(function(a){if(a){var t=$("<div/>").html(a);$(document).find("body header .block_header_items").html("").html($(t).find("header").html()),$(document).find("main").html("").html($(t).find("main").html()).attr("class",$(t).find("main").attr("class")),$(document).html("").find("footer").html($(t).find("footer").html())}})}function content_download(a){return!(!session_key||!a)&&$.ajax({url:site_url,data:$.extend(a,ajax_salt),method:"POST"}).fail(function(a){app_status({error:"Ошибка соединения"})}).done(function(a){a&&(ajaxResult=$.parseJSON(a),app_status(ajaxResult))})}function content_upload(a,t){if(arrPageParams=[],arrPageParams.url=a,a.indexOf("?")+1){var r=a.split("?");if(r[1]){var e=r[1].split("&");$.each(e,function(a,t){var r=t.split("=");arrPageParams[r[0]]=r[1]})}t=$.extend(t,arrPageParams)}return t&&(arrPageParams=$.extend(t,arrPageParams)),content_history(),$("body").addClass("_load_"),$("#main_menu, #main_menu_show").removeClass("_active_"),$("body").removeClass("_no_active_"),$.when(content_template(a),content_download(t)).done(function(a,t){t[0]&&(jsonData=$.parseJSON(t[0]),$.each(jsonData,function(a,t){$(document).find("[data-key="+a+"]").html(t);var r="data-"+a;$(document).find("["+r+"]").attr(r,t)}),scroll_to(0,0,0)),$("body").removeClass("_load_")}),!1}function content_history(){if(oButtonBack.removeClass("_active_"),arrPageParams.pages_history_not)return arrPageParams.pages_history_not=!1,!1;if(arrPageParams.url){if(arrPageParams.pages_history_clear&&(arrPagesHistory=[]),arrPagesHistory.length>=intPagesHistoryLimit){var a=arrPagesHistory.length-parseInt(intPagesHistoryLimit)+1,t=arrPagesHistory.length;arrPagesHistory=arrPagesHistory.slice(a,t)}arrPageHistory=arrPageParams,arrPagesHistory.push(arrPageHistory),localStorage.setItem("arrPagesHistory",JSON.stringify(arrPagesHistory))}arrPagesHistory.length>1&&oButtonBack.addClass("_active_")}$(function(){$(document).on("click",".content_upload",function(){return content_upload($(this).attr("href"),$(this).data())}),oButtonBack.on("click",function(){var a=arrPagesHistory[arrPagesHistory.length-2];arrPagesHistory=arrPagesHistory.slice(0,arrPagesHistory.length-2),content_upload(a.url,a)}),$(document).on("click",".collaps_block .collaps_btn a",function(){return $(this).parents(".collaps_block").toggleClass("_active_"),!1})});