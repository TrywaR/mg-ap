function template_parse(t,e){var t=$("<div/>").html(t),a=$(t).find("header").length>0?$(t).find("header").html():"",n=$(t).find("main").length>0?$(t).find("main").html():"",o=$(t).find("main").length>0?$(t).find("main").attr("class"):"",l=$(t).find("footer").length>0?$(t).find("footer").html():"";content_parse(n),$(document).find("body header .block_header_items").html(a),$(document).find("body main").html(n).attr("class",""),$(document).find("body main").addClass(o),$(document).find("body footer").html(l),$(document).find("#main_menu li."+o).addClass("_active_").siblings().removeClass("_active_")}function content_parse(t){sResultHtml="",$(t).find("[data-items]").length>0&&$(t).find("[data-items]").each(function(t,e){var a="templates/"+$(this).data().template+".htm",n=$(this).data().items,o="",l={};l.items=$(this).data().items,$.ajax({url:a,method:"POST"}).fail(function(t){return app_status({error:"Шаблон не найден"}),!1}).done(function(t){oTemplate=$.parseHTML(t),o=$(oTemplate).attr("class"),$.ajax({url:site_url,data:$.extend(l,ajax_salt),method:"POST"}).fail(function(t){return app_status({error:"Ошибка соединения"}),!1}).done(function(t){var e=$.parseJSON(t);jsonResult=e,app_status(e);var a="_active_";$.each(jsonResult,function(t,e){var l=oTemplate;$.each(e,function(t,e){$(l).find("[data-key="+t+"]").html(e)}),sResultHtml+='<div class="'+o+" "+a+'">',sResultHtml+=$(l).html(),sResultHtml+="</div>",$(document).find('[data-items="'+n+'"]').html(sResultHtml),a="",$(e).find("[data-items]").length>0&&content_parse(e)})})})})}function content_upload(t){return $("body").addClass("_load_"),console.log("content_upload: "+t),console.log(t.indexOf("http")),t.indexOf("http")>=0?(console.log("С сайта"),$.ajax({url:t,data:$(this).serialize(),xhrFields:{withCredentials:!1}}).done(function(e){$(document).find("body").html(e),scroll_to(0,0,0),page_prev(t),$("body").removeClass("_load_")})):(console.log("С приложения"),$.post(t,function(e){template_parse(e,t),scroll_to(0,0,0),page_prev(t),$("body").removeClass("_load_")})),!1}$(function(){$(document).on("click",".content_upload",function(){return page_url=$(this).attr("href"),$(this).data("content")?$(this).data("params")?content_upload(page_url,$(this).data("content"),$(this).data("params")):content_upload(page_url,$(this).data("content")):content_upload(page_url),$("#main_menu_show").removeClass("_active_"),$("#main_menu").removeClass("_active_"),$("body").removeClass("_no_active_"),!1}),$(document).on("click",".collaps_block .collaps_btn a",function(){return $(this).parents(".collaps_block").toggleClass("_active_"),!1})});